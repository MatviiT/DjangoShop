{% extends "base.html" %}
{% block content %}

<div class="topbar">
  <div>
    <a href="javascript:history.back()" style="opacity:.7;">← назад</a>
    <h1 style="margin:6px 0 0;">{{ product.name }}</h1>
  </div>

  <div class="currency">
    <a class="{% if currency == 'UAH' %}active{% endif %}" href="{% url 'shop:set_currency' 'UAH' %}">₴</a>
    <a class="{% if currency == 'USD' %}active{% endif %}" href="{% url 'shop:set_currency' 'USD' %}">$</a>
    <a class="{% if currency == 'EUR' %}active{% endif %}" href="{% url 'shop:set_currency' 'EUR' %}">€</a>
    <span style="opacity:.7;">{{ currency }}</span>
  </div>
</div>

<div class="detail">
  <div class="detail-media">
    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.name }}">
    {% else %}
      <div class="img-placeholder" style="height:360px;"></div>
    {% endif %}
  </div>

  <div class="detail-info">
    <div class="price" style="font-size:22px;">
      {% if currency == "USD" %}
        {{ product.price_usd }} $
      {% elif currency == "EUR" %}
        {{ product.price_eur }} €
      {% else %}
        {{ product.price_uah }} ₴
      {% endif %}
    </div>

    {% if product.in_stock %}
      <span class="badge ok">В наявності</span>
    {% else %}
      <span class="badge no">Немає</span>
    {% endif %}

    {% if product.description %}
      <p style="margin-top:14px; color: rgba(0,0,0,.72); line-height:1.55;">
        {{ product.description }}
      </p>
    {% else %}
      <p style="margin-top:14px; color: rgba(0,0,0,.55);">
        Опис ще не доданий.
      </p>
    {% endif %}
  
    
    {% if product.in_stock and product.is_active %}
    <form action="{% url 'cart:add' product.id %}" method="post">
        {% csrf_token %}
        <input type="number" name="qty" value="1" min="1" style="width:80px;">
        <button type="submit">Додати в корзину</button>
      </form>
    {% else %}
      <button type="button" disabled>Недоступно</button>
    {% endif %}


    <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn" href="{% url 'shop:catalog_home' %}">На головну</a>
      <a class="btn" href="{% url 'shop:category_detail' product.category.slug %}">Повернутись до категорії</a>
    </div>
  </div>
</div>

{% if related_products %}
  <h2>
    Інші товари з категорії
    <a href="{% url 'shop:category_detail' product.category.slug %}">
      {{ product.category.name }}
    </a>
  </h2>

  <div class="grid">
    {% for p in related_products %}
      {% include "shop/components/product_card.html" with p=p currency=currency %}
    {% endfor %}
  </div>
{% endif %}


<style>
/* локально для detail, щоб не роздувати css */
.detail{
  margin-top:16px;
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap: 16px;
}
.detail-media{
  background:#fff;
  border:1px solid rgba(0,0,0,.10);
  border-radius: 18px;
  padding: 22px;
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
}
.detail-media img{
  width:100%;
  height:360px;
  object-fit:contain;
  display:block;
}
.detail-info{
  background:#fff;
  border:1px solid rgba(0,0,0,.10);
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
}
@media (max-width: 900px){
  .detail{ grid-template-columns: 1fr; }
}
</style>

{% endblock %}
